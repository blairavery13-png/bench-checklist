<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Installer Daily Report</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  font-weight:700;
  background:#fff;
  color:#000;
}
.wrap{
  max-width:1000px;
  margin:auto;
  padding:16px 16px 140px;
}
h1{margin:0 0 10px;font-weight:900}
.card{
  border:1px solid #dbe2f0;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
label{font-weight:900;margin-bottom:6px;display:block}
input,select,textarea{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #dbe2f0;
  font-weight:800;
  font-size:1.05rem;
}
textarea{min-height:80px}
.row{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.btn{
  background:#0b5ed7;
  color:#fff;
  border:none;
  border-radius:999px;
  padding:14px 20px;
  font-weight:900;
}
.btn.secondary{
  background:#e8f0fe;
  color:#0b5ed7;
}
.photoGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(90px,1fr));
  gap:10px;
  margin-top:10px;
}
.thumb{
  border:1px solid #dbe2f0;
  border-radius:10px;
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:80px;
  object-fit:cover;
}
.q{
  border:1px solid #dbe2f0;
  border-radius:12px;
  padding:12px;
  margin-top:12px;
}
.choice{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:8px;
}
.choice input{display:none}
.choice label{
  text-align:center;
  padding:14px;
  border-radius:999px;
  border:2px solid #dbe2f0;
}
.choice input:checked+label.y{background:#dcfce7}
.choice input:checked+label.n{background:#fee2e2}
.follow{display:none;margin-top:8px}
.bottom{
  position:fixed;
  left:0;right:0;bottom:0;
  background:#fff;
  border-top:1px solid #dbe2f0;
  padding:10px;
}
.bottomInner{
  max-width:1000px;
  margin:auto;
  display:flex;
  justify-content:flex-end;
}
</style>
</head>

<body>
<div class="wrap">
<h1>Installer Daily Report</h1>

<div class="card">
<div class="row">
<div><label>Date</label><input id="date" readonly></div>
<div>
<label>Installer</label>
<select id="installer">
<option value="">Select</option>
<option>Installer 1</option>
<option>Installer 2</option>
<option>Installer 3</option>
<option>Installer 4</option>
</select>
</div>
<div><label>Job Number</label><input id="job" value="JB"></div>
</div>

<div style="margin-top:10px">
<label>Installed Rooms</label>
<input id="rooms">
</div>
</div>

<div class="card">
<label class="btn secondary">Add Pre Photos
<input type="file" accept="image/*" multiple hidden id="pre">
</label>
<div id="preGrid" class="photoGrid"></div>
</div>

<div class="card">
<label class="btn secondary">Add Issue Photos
<input type="file" accept="image/*" multiple hidden id="issue">
</label>
<div id="issueGrid" class="photoGrid"></div>
</div>

<div class="card">
<label class="btn secondary">Add Final Photos
<input type="file" accept="image/*" multiple hidden id="final">
</label>
<div id="finalGrid" class="photoGrid"></div>
</div>

<div class="card">
<b>Checklist</b>
<div id="checklist"></div>
</div>
</div>

<div class="bottom">
<div class="bottomInner">
<button class="btn" onclick="exportZIP()">Finish & Export ZIP</button>
</div>
</div>

<script>
const QUESTIONS=[
"Prior damage to walls / area?",
"Prior damage to cabinetry?",
"Access issues?",
"Site issues?",
"Was installation delayed?",
"Wall dimensions correct?",
"Bulkheads / kickboards correct?",
"Doors / drawers operating correctly?",
"Cabinet build correct?",
"Hardware missing?",
"Hardware incorrect?",
"Handles fitted / correct?",
"Bump-ons fitted?",
"Plastic legs incorrect?",
"Pull-out / lighting issues?",
"Return visit required?"
];

const photos={pre:[],issue:[],final:[]};
const thumbs={pre:[],issue:[],final:[]};

document.getElementById("date").value=new Date().toLocaleDateString();
document.getElementById("job").oninput=e=>{
let v=e.target.value||"";
if(!v.startsWith("JB"))v="JB"+v.replace(/[^0-9]/g,"");
e.target.value=v.toUpperCase();
};

const checklist=document.getElementById("checklist");
QUESTIONS.forEach((q,i)=>{
const d=document.createElement("div");
d.className="q";
d.innerHTML=`${i+1}. ${q}
<div class="choice">
<input type="radio" name="q${i}" value="Yes" id="y${i}">
<label class="y" for="y${i}">Yes</label>
<input type="radio" name="q${i}" value="No" id="n${i}">
<label class="n" for="n${i}">No</label>
</div>
<div class="follow"><textarea placeholder="Comment (if required)"></textarea></div>`;
checklist.appendChild(d);

const follow=d.querySelector(".follow");
d.querySelectorAll("input").forEach(r=>{
r.onchange=()=>follow.style.display="block";
});
});

async function makeThumb(file){
const img=await createImageBitmap(file);
const scale=90/img.width;
const c=document.createElement("canvas");
c.width=90;c.height=img.height*scale;
c.getContext("2d").drawImage(img,0,0,c.width,c.height);
return c.toDataURL("image/jpeg",0.6);
}

["pre","issue","final"].forEach(k=>{
document.getElementById(k).onchange=async e=>{
for(const f of e.target.files){
photos[k].push(f);
thumbs[k].push(await makeThumb(f));
}
render();
};
});

function render(){
["pre","issue","final"].forEach(k=>{
const g=document.getElementById(k+"Grid");
g.innerHTML="";
thumbs[k].forEach(t=>{
const d=document.createElement("div");
d.className="thumb";
d.innerHTML=`<img src="${t}">`;
g.appendChild(d);
});
});
}

async function exportZIP(){
const zip=new JSZip();
const job=jobInput.value||"JB";
const name=`${job} – ${installer.value} – ${date.value}`;

const {jsPDF}=window.jspdf;
const pdf=new jsPDF();
let y=10;

pdf.setFont("helvetica","bold");
pdf.text(`Job: ${job}`,10,y);y+=8;
pdf.text(`Rooms: ${rooms.value}`,10,y);y+=8;
pdf.text(`Installer: ${installer.value}`,10,y);y+=8;
pdf.text(`Date: ${date.value}`,10,y);y+=10;

pdf.setFont("helvetica","normal");
document.querySelectorAll(".q").forEach((q,i)=>{
const ans=q.querySelector("input:checked");
pdf.text(`${i+1}. ${QUESTIONS[i]}  —  ${ans?ans.value:"Not answered"}`,10,y);
y+=7;
const t=q.querySelector("textarea").value;
if(t){pdf.text(`   Comment: ${t}`,10,y);y+=7;}
if(y>270){pdf.addPage();y=10;}
});

zip.file("Daily Report.pdf",pdf.output("arraybuffer"));

["pre","issue","final"].forEach(k=>{
const f=zip.folder(`Photos – ${k}`);
photos[k].forEach((p,i)=>f.file(`${k}_${i+1}.jpg`,p));
});

const blob=await zip.generateAsync({type:"blob"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=name+".zip";
a.click();
}
</script>
</body>
</html>
