<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Installer Daily Report</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;font-weight:700;background:#fff;color:#000}
.wrap{max-width:1000px;margin:auto;padding:16px 16px 160px}
h1{margin:0 0 10px;font-weight:900}
.card{border:1px solid #dbe2f0;border-radius:14px;padding:14px;margin-bottom:14px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
label{font-weight:900;margin-bottom:6px;display:block}
input,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid #dbe2f0;font-weight:800;font-size:1.05rem}
textarea{min-height:80px}
.btn{background:#0b5ed7;color:#fff;border:none;border-radius:999px;padding:14px 18px;font-weight:900}
.btn.secondary{background:#e8f0fe;color:#0b5ed7}
.btn:disabled{opacity:.6}
.photoGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(95px,1fr));gap:10px;margin-top:10px}
.thumb{border:1px solid #dbe2f0;border-radius:10px;overflow:hidden}
.thumb img{width:100%;height:80px;object-fit:cover}
.q{border:1px solid #dbe2f0;border-radius:12px;padding:12px;margin-top:12px}
.qTitle{font-weight:900;margin-bottom:8px}
.choice{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.choice input{display:none}
.pill{border-radius:999px;border:2px solid #dbe2f0;padding:14px;text-align:center;font-weight:900}
.choice input:checked+.good{background:#dcfce7;border-color:#16a34a}
.choice input:checked+.bad{background:#fee2e2;border-color:#dc2626}
.follow{display:none;margin-top:10px}
.bottom{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #dbe2f0;padding:10px}
.bottomInner{max-width:1000px;margin:auto;display:flex;justify-content:flex-end;gap:12px}
.status{font-weight:900;color:#4b5563}
</style>
</head>

<body>
<div class="wrap">
<h1>Installer Daily Report</h1>

<div class="card">
<div class="row">
<div><label>Date</label><input id="date" readonly></div>
<div>
<label>Installer</label>
<select id="installer">
<option value="">Select</option>
<option>Installer 1</option>
<option>Installer 2</option>
<option>Installer 3</option>
<option>Installer 4</option>
</select>
</div>
<div><label>Job Number</label><input id="job" value="JB"></div>
</div>
<div style="margin-top:10px">
<label>Installed Rooms</label>
<input id="rooms">
</div>
</div>

<div class="card">
<label>Pre Photos</label>
<input type="file" accept="image/*" multiple onchange="addPhotos(event,'pre')">
<div id="preGrid" class="photoGrid"></div>
</div>

<div class="card">
<label>Issue Photos</label>
<input type="file" accept="image/*" multiple onchange="addPhotos(event,'issue')">
<div id="issueGrid" class="photoGrid"></div>
</div>

<div class="card">
<label>Final Photos</label>
<input type="file" accept="image/*" multiple onchange="addPhotos(event,'final')">
<div id="finalGrid" class="photoGrid"></div>
</div>

<div class="card">
<b>Checklist</b>
<div id="checklist"></div>
</div>
</div>

<div class="bottom">
<div class="bottomInner">
<div id="status" class="status"></div>
<button id="exportBtn" class="btn" onclick="exportZIP()">Finish & Share ZIP</button>
</div>
</div>

<script>
const QUESTION_DEFS=[
{t:"Prior damage to walls / area?",bad:"Yes"},
{t:"Prior damage to cabinetry?",bad:"Yes"},
{t:"Access issues?",bad:"Yes"},
{t:"Site issues?",bad:"Yes"},
{t:"Was installation delayed?",bad:"Yes"},
{t:"Wall dimensions correct?",bad:"No"},
{t:"Bulkheads / kickboards correct?",bad:"No"},
{t:"Doors / drawers operating correctly?",bad:"No"},
{t:"Cabinet build correct?",bad:"No",build:true},
{t:"Cabinetry missing?",bad:"Yes"},
{t:"Hardware missing?",bad:"Yes"},
{t:"Hardware incorrect?",bad:"Yes"},
{t:"Handles fitted / correct?",bad:"No"},
{t:"Bump-ons fitted?",bad:"No"},
{t:"Plastic legs incorrect?",bad:"Yes"},
{t:"Pull-out / lighting issues?",bad:"Yes"},
{t:"Return visit required?",bad:"Yes"},
{t:"Dispute / builder claim risk?",bad:"Yes"}
];

const photos={pre:[],issue:[],final:[]};

date.value=new Date().toLocaleDateString();

function buildChecklist(){
QUESTION_DEFS.forEach((q,i)=>{
const d=document.createElement("div");
d.className="q";
d.innerHTML=`<div class="qTitle">${i+1}. ${q.t}</div>`;
const c=document.createElement("div");c.className="choice";
["Yes","No"].forEach(v=>{
const id=`q${i}${v}`;
c.innerHTML+=`
<input type="radio" name="q${i}" id="${id}" value="${v}">
<label for="${id}" class="pill ${v===q.bad?"bad":"good"}">${v}</label>`;
});
d.appendChild(c);
if(q.build){
const f=document.createElement("div");
f.className="follow";
f.innerHTML=`<input placeholder="Built by"><textarea placeholder="Issue"></textarea>`;
d.appendChild(f);
}
checklist.appendChild(d);
});
}
buildChecklist();

function addPhotos(e,b){
[...e.target.files].forEach(f=>{
photos[b].push(f);
const img=document.createElement("img");
img.src=URL.createObjectURL(f);
const d=document.createElement("div");
d.className="thumb";d.appendChild(img);
document.getElementById(b+"Grid").appendChild(d);
});
}

async function exportZIP(){
exportBtn.disabled=true;
status.textContent="Preparing ZIPâ€¦";

try{
const zip=new JSZip();
const job=job.value.toUpperCase();
const dateStr=date.value;

const pdf=new jspdf.jsPDF();
pdf.text(`Job: ${job}`,10,10);
pdf.text(`Rooms: ${rooms.value}`,10,18);
pdf.text(`Installer: ${installer.value}`,10,26);
zip.file("Report.pdf",pdf.output("arraybuffer"));

["pre","issue","final"].forEach(k=>{
const f=zip.folder("Photos_"+k);
photos[k].forEach((p,i)=>f.file(`${k}_${i+1}.jpg`,p));
});

const blob=await zip.generateAsync({type:"blob",streamFiles:true,compression:"STORE"});
const file=new File([blob],`${job}_${dateStr}.zip`,{type:"application/zip"});

if(navigator.share){
await navigator.share({
files:[file],
title:"Installer Report",
text:"Daily installer report"
});
status.textContent="Shared successfully";
}else{
alert("Sharing not supported on this device");
}
}catch(e){
console.error(e);
alert("Export failed");
}
exportBtn.disabled=false;
}
</script>
</body>
</html>
