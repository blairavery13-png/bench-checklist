<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Installer Daily Report</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script defer src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f6f8fb}
.wrap{max-width:1000px;margin:auto;padding:16px 16px 120px}
.card{background:#fff;border:1px solid #dbe2f0;border-radius:14px;padding:14px;margin-bottom:12px}
h1{margin:0 0 10px;color:#0b2d6a}
label{font-size:.9rem;color:#64748b}
input,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid #dbe2f0;font-size:1.05rem}
textarea{min-height:80px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.btn{background:#0b5ed7;color:#fff;border:none;border-radius:999px;padding:14px 18px;font-weight:800}
.btn.secondary{background:#fff;color:#0b2d6a;border:1px solid #cfe0ff}
.bottom{position:fixed;left:0;right:0;bottom:0;background:#f6f8fb;border-top:1px solid #dbe2f0;padding:10px}
.bottomInner{max-width:1000px;margin:auto;display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap}
.q{border:1px solid #dbe2f0;border-radius:12px;padding:12px;margin-top:10px}
.q.missing{outline:3px solid rgba(245,158,11,.35)}
.choice{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
.choice input{display:none}
.choice label{display:block;text-align:center;padding:14px;border-radius:999px;border:2px solid #cfe0ff;font-weight:800;cursor:pointer}
.choice input:checked+label.y{background:#e7f6ed;border-color:#bfe7cc}
.choice input:checked+label.n{background:#ffecec;border-color:#ffc6c6}
.photoGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:10px}
.thumb{border:1px solid #dbe2f0;border-radius:12px;overflow:hidden}
.thumb img{width:100%;height:120px;object-fit:cover}
</style>
</head>

<body>
<div class="wrap">
<h1>Installer Daily Report</h1>

<div class="card">
<div class="row">
<div><label>Date</label><input id="date" readonly></div>
<div>
<label>Installer</label>
<select id="installer">
<option value="">Selectâ€¦</option>
<option>Installer 1</option>
<option>Installer 2</option>
<option>Installer 3</option>
<option>Installer 4</option>
</select>
</div>
<div><label>Job Number</label><input id="job" value="JB"></div>
</div>
<div style="margin-top:10px">
<label>Notes</label>
<textarea id="notes"></textarea>
</div>
</div>

<div class="card">
<b>Photos</b>
<div style="margin-top:8px">
<label class="btn secondary">Add Pre Photos<input type="file" id="pre" multiple hidden></label>
<div id="preGrid" class="photoGrid"></div>
</div>
<div style="margin-top:8px">
<label class="btn secondary">Add Issue Photos<input type="file" id="issue" multiple hidden></label>
<div id="issueGrid" class="photoGrid"></div>
</div>
<div style="margin-top:8px">
<label class="btn secondary">Add Final Photos<input type="file" id="final" multiple hidden></label>
<div id="finalGrid" class="photoGrid"></div>
</div>
</div>

<div class="card">
<b>Checklist</b>
<div id="checklist"></div>
</div>
</div>

<div class="bottom">
<div class="bottomInner">
<div id="status">Ready</div>
<div>
<button class="btn secondary" onclick="exportData(false)">Export</button>
<button class="btn" onclick="exportData(true)">Finish & Export</button>
</div>
</div>
</div>

<script>
const QUESTIONS=[
{id:"damage",t:"Any cabinet damage?",c:"Yes"},
{id:"missing",t:"Any hardware missing?",c:"Yes"},
{id:"legs",t:"Plastic legs incorrect?",c:"Yes"},
{id:"access",t:"Access issues on site?",c:"Yes"},
{id:"dims",t:"Dimensions incorrect?",c:"Yes"},
{id:"handles",t:"Handles correct?",c:"No"},
{id:"bumpons",t:"Bump-ons fitted?",c:"No"}
];

const state={a:{},p:{pre:[],issue:[],final:[]}};
document.getElementById("date").value=new Date().toLocaleDateString(undefined,{weekday:"long",year:"numeric",month:"long",day:"numeric"});

const job=document.getElementById("job");
job.addEventListener("input",e=>{
let v=e.target.value||"";
if(v.length>=2)v="JB"+v.slice(2);
e.target.value=v.toUpperCase();
});

const checklist=document.getElementById("checklist");
QUESTIONS.forEach((q,i)=>{
const d=document.createElement("div");
d.className="q";
d.id=q.id;
d.innerHTML=`${i+1}. ${q.t}
<div class="choice">
<input type="radio" name="${q.id}" value="Yes" id="${q.id}y"><label class="y" for="${q.id}y">Yes</label>
<input type="radio" name="${q.id}" value="No" id="${q.id}n"><label class="n" for="${q.id}n">No</label>
</div>
<textarea placeholder="Comment" style="display:none"></textarea>`;
checklist.appendChild(d);

d.querySelectorAll("input").forEach(r=>{
r.onchange=()=>{
state.a[q.id]={v:r.value,c:""};
const t=d.querySelector("textarea");
t.style.display=(r.value===q.c)?"block":"none";
};
});
d.querySelector("textarea").oninput=e=>state.a[q.id].c=e.target.value;
});

["pre","issue","final"].forEach(k=>{
document.getElementById(k).onchange=e=>{
Array.from(e.target.files).forEach(f=>{
const img=document.createElement("img");
img.src=URL.createObjectURL(f);
document.getElementById(k+"Grid").appendChild(Object.assign(document.createElement("div"),{className:"thumb"})).appendChild(img);
});
};
});

async function exportData(clear){
const zip=new JSZip();
zip.file("data.json",JSON.stringify(state,null,2));
const blob=await zip.generateAsync({type:"blob"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=`${job.value}_${new Date().toISOString().slice(0,10)}.zip`;
a.click();
if(clear)location.reload();
}
</script>
</body>
</html>
