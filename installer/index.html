<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Installer Daily Report</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
:root{
  --bg:#ffffff; --card:#ffffff; --border:#dbe2f0; --blue:#0b5ed7;
  --text:#000; --muted:#4b5563; --good:#16a34a; --bad:#dc2626;
}
[data-theme="dark"]{
  --bg:#0b1220; --card:#0f1b33; --border:#233a63; --blue:#3b82f6;
  --text:#fff; --muted:#cbd5e1; --good:#22c55e; --bad:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:Arial,Helvetica,sans-serif;font-weight:700}
.wrap{max-width:1000px;margin:auto;padding:16px 16px 150px}
.topRow{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
h1{margin:0;font-weight:900;font-size:1.4rem}
.toggle{border:1px solid var(--border);background:var(--card);border-radius:999px;padding:10px 14px;font-weight:900}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:14px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
label{font-weight:900;margin-bottom:6px;display:block}
input,select,textarea{
  width:100%;padding:14px;border-radius:12px;border:1px solid var(--border);
  font-weight:800;font-size:1.05rem
}
textarea{min-height:80px}
.btn{border:none;background:var(--blue);color:#fff;border-radius:999px;padding:14px 18px;font-weight:900}
.btn.secondary{background:#e8f0fe;color:var(--blue)}
.photoGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(95px,1fr));gap:10px;margin-top:10px}
.thumb{border:1px solid var(--border);border-radius:10px;overflow:hidden}
.thumb img{width:100%;height:80px;object-fit:cover}
.q{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:12px}
.qTitle{font-weight:900;margin-bottom:8px}
.choice{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.choice input{display:none}
.pill{border-radius:999px;border:2px solid var(--border);padding:14px;text-align:center;font-weight:900}
.choice input:checked+.goodSel{border-color:var(--good);background:#dcfce7}
.choice input:checked+.badSel{border-color:var(--bad);background:#fee2e2}
.follow{display:none;margin-top:10px}
.bottom{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top:1px solid var(--border);padding:10px}
.bottomInner{max-width:1000px;margin:auto;display:flex;justify-content:flex-end;gap:10px}
.status{font-weight:900;color:var(--muted)}
</style>
</head>

<body>
<div class="wrap">
<div class="topRow">
<h1>Installer Daily Report</h1>
<button class="toggle" onclick="toggleTheme()">Light / Dark</button>
</div>

<div class="card">
<div class="row">
<div><label>Date</label><input id="date" readonly></div>
<div>
<label>Installer</label>
<select id="installer">
<option value="">Select</option>
<option>Installer 1</option>
<option>Installer 2</option>
<option>Installer 3</option>
<option>Installer 4</option>
</select>
</div>
<div><label>Job Number</label><input id="job" value="JB"></div>
</div>

<div style="margin-top:10px">
<label>Installed Rooms</label>
<input id="rooms" placeholder="Kitchen, Laundry, Vanities">
</div>

<div style="margin-top:10px">
<label>Cabinetry built by</label>
<input id="builtByTop" placeholder="Bench / Colour / Name">
</div>
</div>

<div class="card">
<label>Pre Photos</label>
<button class="btn secondary" onclick="openPhotoChoice('pre')">Add Pre Photos</button>
<div id="preGrid" class="photoGrid"></div>
</div>

<div class="card">
<label>Issue Photos</label>
<button class="btn secondary" onclick="openPhotoChoice('issue')">Add Issue Photos</button>
<div id="issueGrid" class="photoGrid"></div>
</div>

<div class="card">
<label>Final Photos</label>
<button class="btn secondary" onclick="openPhotoChoice('final')">Add Final Photos</button>
<div id="finalGrid" class="photoGrid"></div>
</div>

<div class="card">
<b>Checklist</b>
<div id="checklist"></div>
</div>
</div>

<div class="bottom">
<div class="bottomInner">
<div id="exportStatus" class="status"></div>
<button class="btn" onclick="exportZIP()">Finish & Export</button>
</div>
</div>

<input id="camInput" type="file" accept="image/*" capture="environment" multiple hidden>
<input id="galInput" type="file" accept="image/*" multiple hidden>

<script>
const QUESTION_DEFS=[
{t:"Prior damage to walls / area?",bad:"Yes",c:"Yes"},
{t:"Prior damage to cabinetry?",bad:"Yes",c:"Yes"},
{t:"Access issues?",bad:"Yes",c:"Yes"},
{t:"Site issues?",bad:"Yes",c:"Yes"},
{t:"Was installation delayed?",bad:"Yes",c:"Yes"},
{t:"Wall dimensions correct?",bad:"No",c:"No"},
{t:"Bulkheads / kickboards correct?",bad:"No",c:"No"},
{t:"Doors / drawers operating correctly?",bad:"No",c:"No"},
{t:"Cabinet build correct?",bad:"No",c:"No",b:true},
{t:"Cabinetry missing?",bad:"Yes",c:"Yes"},
{t:"Hardware missing?",bad:"Yes",c:"Yes"},
{t:"Hardware incorrect?",bad:"Yes",c:"Yes"},
{t:"Handles fitted / correct?",bad:"No",c:"No"},
{t:"Bump-ons fitted?",bad:"No",c:"No"},
{t:"Plastic legs incorrect?",bad:"Yes",c:"Yes"},
{t:"Pull-out / lighting issues?",bad:"Yes",c:"Yes"},
{t:"Return visit required?",bad:"Yes",c:"Yes"},
{t:"Dispute / builder claim risk?",bad:"Yes",c:"Yes"}
];

const photos={pre:[],issue:[],final:[]};
date.value=new Date().toLocaleDateString();

job.oninput=()=>{let v=job.value.toUpperCase();if(!v.startsWith("JB"))v="JB"+v.replace(/[^0-9]/g,"");job.value=v};

function buildChecklist(){
QUESTION_DEFS.forEach((q,i)=>{
const d=document.createElement("div");d.className="q";
d.innerHTML=`<div class="qTitle">${i+1}. ${q.t}</div>`;
const c=document.createElement("div");c.className="choice";
["Yes","No"].forEach(v=>{
const id=`q${i}${v}`;
c.innerHTML+=`
<input type="radio" name="q${i}" id="${id}" value="${v}">
<label for="${id}" class="pill ${v===q.bad?"badSel":"goodSel"}">${v}</label>`;
});
d.appendChild(c);
const f=document.createElement("div");f.className="follow";
f.innerHTML=q.b?
`<input placeholder="Built by"><textarea placeholder="Issue"></textarea>`:
`<textarea placeholder="Comment"></textarea>`;
d.appendChild(f);
c.querySelectorAll("input").forEach(r=>r.onchange=()=>f.style.display=r.value===q.c?"block":"none");
checklist.appendChild(d);
});
}
buildChecklist();

let activeBucket="pre";
function openPhotoChoice(b){activeBucket=b;galInput.click()}
galInput.onchange=e=>{
[...e.target.files].forEach(f=>{
photos[activeBucket].push(f);
const img=document.createElement("img");
img.src=URL.createObjectURL(f);
const d=document.createElement("div");d.className="thumb";d.appendChild(img);
document.getElementById(activeBucket+"Grid").appendChild(d);
});
};

function safe(n){return n.replace(/[\/\\:*?"<>|]/g,"-").trim()}
async function exportZIP(){
exportStatus.textContent="Exporting…";
const zip=new JSZip();
const zipName=safe(`${job.value} – ${installer.value} – ${rooms.value}`)+".zip";

const pdf=new jspdf.jsPDF();
pdf.text(`Job: ${job.value}`,10,10);
pdf.text(`Rooms: ${rooms.value}`,10,18);
pdf.text(`Installer: ${installer.value}`,10,26);
pdf.text(`Built by: ${builtByTop.value}`,10,34);
zip.file("Report.pdf",pdf.output("arraybuffer"));

["pre","issue","final"].forEach(k=>{
const f=zip.folder(k);
photos[k].forEach((p,i)=>f.file(`${k}_${i+1}.jpg`,p));
});

const blob=await zip.generateAsync({type:"blob",compression:"STORE"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);a.download=zipName;a.click();
exportStatus.textContent="Download started";
}
</script>
</body>
</html>
