<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Installer Daily Report</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<style>
:root{
  --bg:#ffffff;
  --card:#ffffff;
  --border:#dbe2f0;
  --blue:#0b5ed7;
  --text:#000000;
}
body.dark{
  --bg:#0f172a;
  --card:#111827;
  --border:#334155;
  --blue:#3b82f6;
  --text:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  font-weight:700;
  background:var(--bg);
  color:var(--text);
}
.wrap{
  max-width:1000px;
  margin:auto;
  padding:16px 16px 140px;
}
h1{margin:0 0 10px;font-weight:900}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
label{font-weight:900;margin-bottom:6px;display:block}
input,select,textarea{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  font-weight:800;
  font-size:1.05rem;
}
textarea{min-height:80px}
.row{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.btn{
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:999px;
  padding:14px 20px;
  font-weight:900;
  cursor:pointer;
}
.btn.secondary{
  background:transparent;
  color:var(--text);
  border:2px solid var(--blue);
}
.photoGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
  gap:10px;
  margin-top:10px;
}
.thumb{
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
}
.thumb img{
  width:100%;
  height:90px;
  object-fit:cover;
}
.q{
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin-top:12px;
}
.choice{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:8px;
}
.choice input{display:none}
.choice label{
  text-align:center;
  padding:14px;
  border-radius:999px;
  border:2px solid var(--border);
  cursor:pointer;
}
.choice input:checked+label.y{background:#dcfce7}
.choice input:checked+label.n{background:#fee2e2}
.follow{display:none;margin-top:8px}
.bottom{
  position:fixed;
  left:0;right:0;bottom:0;
  background:var(--bg);
  border-top:1px solid var(--border);
  padding:10px;
}
.bottomInner{
  max-width:1000px;
  margin:auto;
  display:flex;
  justify-content:space-between;
}
.toggle{cursor:pointer;font-weight:900;text-decoration:underline}
</style>
</head>

<body>
<div class="wrap">
<h1>Installer Daily Report</h1>
<div class="toggle" onclick="toggleMode()">Light / Dark</div>

<div class="card">
<div class="row">
<div><label>Date</label><input id="date" readonly></div>
<div>
<label>Installer</label>
<select id="installer">
<option value="">Select</option>
<option>Installer 1</option>
<option>Installer 2</option>
<option>Installer 3</option>
<option>Installer 4</option>
</select>
</div>
<div><label>Job Number</label><input id="job" value="JB"></div>
</div>

<div style="margin-top:10px">
<label>Installed Rooms</label>
<input id="rooms">
</div>
</div>

<!-- PHOTOS -->
<div class="card">
<label class="btn secondary">Add Pre Photos<input type="file" id="pre" accept="image/*" multiple hidden></label>
<div id="preGrid" class="photoGrid"></div>
</div>

<div class="card">
<label class="btn secondary">Add Issue Photos<input type="file" id="issue" accept="image/*" multiple hidden></label>
<div id="issueGrid" class="photoGrid"></div>
</div>

<div class="card">
<label class="btn secondary">Add Final Photos<input type="file" id="final" accept="image/*" multiple hidden></label>
<div id="finalGrid" class="photoGrid"></div>
</div>

<div class="card">
<b>Checklist</b>
<div id="checklist"></div>
</div>
</div>

<div class="bottom">
<div class="bottomInner">
<div></div>
<button class="btn" onclick="exportZIP()">Finish & Export ZIP</button>
</div>
</div>

<script>
const QUESTIONS=[
["Prior damage to walls / area?","Yes"],
["Prior damage to cabinetry?","Yes"],
["Access issues?","Yes"],
["Site issues?","Yes"],
["Was installation delayed?","Yes"],
["Wall dimensions correct?","No"],
["Bulkheads / kickboards correct?","No"],
["Doors / drawers operating correctly?","No"],
["Cabinet build correct?","No","builder"],
["Hardware missing?","Yes"],
["Hardware incorrect?","Yes"],
["Handles fitted / correct?","No"],
["Bump-ons fitted?","No"],
["Plastic legs incorrect?","Yes"],
["Pull-out / lighting issues?","Yes"],
["Return visit required?","Yes"],
["Dispute / builder claim risk?","Yes"]
];

const photos={pre:[],issue:[],final:[]};
const thumbs={pre:[],issue:[],final:[]};

document.getElementById("date").value=new Date().toLocaleDateString();

document.getElementById("job").oninput=e=>{
let v=e.target.value||"";
if(v.length>=2)v="JB"+v.slice(2);
e.target.value=v.toUpperCase();
};

const checklist=document.getElementById("checklist");
QUESTIONS.forEach((q,i)=>{
const d=document.createElement("div");
d.className="q";
d.innerHTML=`${i+1}. ${q[0]}
<div class="choice">
<input type="radio" name="q${i}" value="Yes" id="y${i}">
<label class="y" for="y${i}">Yes</label>
<input type="radio" name="q${i}" value="No" id="n${i}">
<label class="n" for="n${i}">No</label>
</div>
<div class="follow">
${q[2]==="builder" ? `<input placeholder="Built by">` : ""}
<textarea placeholder="Issue / Comment"></textarea>
</div>`;
checklist.appendChild(d);

const follow=d.querySelector(".follow");
d.querySelectorAll("input[type=radio]").forEach(r=>{
r.onchange=()=>follow.style.display=(r.value===q[1])?"block":"none";
});
});

async function makeThumb(file){
const img=await createImageBitmap(file);
const scale=100/img.width;
const canvas=document.createElement("canvas");
canvas.width=100;
canvas.height=img.height*scale;
canvas.getContext("2d").drawImage(img,0,0,canvas.width,canvas.height);
return canvas.toDataURL("image/jpeg",0.6);
}

["pre","issue","final"].forEach(k=>{
document.getElementById(k).onchange=async e=>{
for(const f of e.target.files){
photos[k].push(f);
thumbs[k].push(await makeThumb(f));
}
renderPhotos();
};
});

function renderPhotos(){
["pre","issue","final"].forEach(k=>{
const g=document.getElementById(k+"Grid");
g.innerHTML="";
thumbs[k].forEach(t=>{
const div=document.createElement("div");
div.className="thumb";
div.innerHTML=`<img src="${t}">`;
g.appendChild(div);
});
});
}

function toggleMode(){document.body.classList.toggle("dark")}

async function exportZIP(){
const zip=new JSZip();
const job=jobNumber();
const base=`${job} – ${rooms.value} – ${installer.value} – ${date.value}`;

const {jsPDF}=window.jspdf;
const doc=new jsPDF();
let y=10;
doc.text(`Job: ${job}`,10,y);y+=8;
doc.text(`Rooms: ${rooms.value}`,10,y);y+=8;
doc.text(`Installer: ${installer.value}`,10,y);y+=8;
doc.text(`Date: ${date.value}`,10,y);y+=10;

document.querySelectorAll(".q").forEach(q=>{
doc.text(q.innerText,10,y);y+=8;
});

zip.file("Daily Report.pdf",doc.output("arraybuffer"));

["pre","issue","final"].forEach(k=>{
const folder=zip.folder(`Photos – ${k[0].toUpperCase()+k.slice(1)}`);
photos[k].forEach((f,i)=>folder.file(`${k}_${i+1}.jpg`,f));
});

zip.generateAsync({type:"blob"}).then(b=>{
const a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download=base+".zip";
a.click();
location.reload();
});
}

function jobNumber(){return document.getElementById("job").value||"JB";}
</script>
</body>
</html>
