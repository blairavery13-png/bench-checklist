<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bench Checklist</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:#0b1120;color:#e5e7eb;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;font-size:18px}
body{display:flex;justify-content:center;padding:16px}
.app{width:100%;max-width:980px;background:#111827;border-radius:16px;padding:20px;border:1px solid #1f2937}

.topBar{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.dot{width:14px;height:14px;border-radius:999px;background:#ef4444;box-shadow:0 0 0 4px rgba(239,68,68,.12)}
.dot.green{background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.12)}

.btn{padding:10px 16px;border-radius:999px;border:1px solid #4b5563;background:#020617;color:#e5e7eb;font-size:.9rem;font-weight:950;cursor:pointer}
.btn.primary{background:#1d4ed8;border-color:#2563eb}
.btn:disabled{opacity:.45;cursor:not-allowed}

.section-title{margin:18px 0 10px;font-weight:900;border-bottom:1px solid #1f2937;padding-bottom:6px}

.field-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.field label{font-size:.9rem;font-weight:900}
.field input{width:100%;padding:12px;margin-top:4px;border-radius:10px;background:#020617;border:1px solid #4b5563;color:#e5e7eb;font-weight:800}

.required{border-color:#ef4444!important;box-shadow:0 0 0 4px rgba(239,68,68,.12)}

.question{background:#020617;border:1px solid #1f2937;border-radius:14px;padding:14px;margin-bottom:16px}
.q-text{margin-bottom:12px;font-weight:900}

.answers{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.answers.two{grid-template-columns:repeat(2,1fr)}
.answers input{display:none}
.answers label{padding:14px 0;text-align:center;border-radius:999px;border:1px solid #4b5563;background:#111827;font-weight:900;cursor:pointer}
.answers input:checked + label.yes{background:#16a34a;border-color:#16a34a}
.answers input:checked + label.no{background:#b91c1c;border-color:#b91c1c}
.answers input:checked + label.na{background:#374151;border-color:#9ca3af}
.answers input:disabled + label{opacity:.45;cursor:not-allowed}

.notes{margin-top:12px}
.notes textarea{width:100%;min-height:70px;padding:10px;border-radius:10px;background:#020617;border:1px solid #4b5563;color:#e5e7eb;font-weight:800}

.bottomBar{display:flex;gap:10px;flex-wrap:wrap}
</style>
</head>

<body>
<div class="app">

<div class="topBar">
  <button class="btn" onclick="loadJSON()">Load JSON</button>
  <span id="dot" class="dot"></span>
</div>

<div class="section-title">Job Details</div>
<div class="field-row">
  <div class="field"><label>Checklist filled by</label><input id="filledBy"></div>
  <div class="field"><label>Job number</label><input id="jobNumber"></div>
  <div class="field"><label>Room</label><input id="room"></div>
</div>

<div class="section-title">Checklist</div>
<div id="questions"></div>

<div class="section-title">Final Confirmation</div>
<div class="question">
  <div class="q-text">Is this room complete and has all cabinetry & required hardware been supplied?</div>
  <div class="answers two">
    <input type="radio" id="finalYes" name="final" value="Yes">
    <label class="yes" for="finalYes">ðŸŸ¢ YES</label>
    <input type="radio" id="finalNo" name="final" value="No">
    <label class="no" for="finalNo">ðŸ”´ NO</label>
  </div>
</div>

<div class="bottomBar">
  <button class="btn" onclick="saveJSON()">Save Draft (JSON)</button>
  <button class="btn primary" id="exportBtn" onclick="exportPDF()">Export Completion Sheet (PDF)</button>
</div>

<input type="file" id="fileInput" accept=".json">

</div>

<script>
const QUESTIONS=[
"Colour caps supplied?",
"Sizes checked?",
"LEDs supplied & tested?",
"Handles installed?",
"Cleats supplied?",
"Doors & drawers defect free?"
];

const filledBy=document.getElementById("filledBy");
const jobNumber=document.getElementById("jobNumber");
const room=document.getElementById("room");
const finalYes=document.getElementById("finalYes");
const finalNo=document.getElementById("finalNo");
const exportBtn=document.getElementById("exportBtn");
const dot=document.getElementById("dot");
const questionsDiv=document.getElementById("questions");
const fileInput=document.getElementById("fileInput");

function render(){
questionsDiv.innerHTML="";
QUESTIONS.forEach((q,i)=>{
const d=document.createElement("div");
d.className="question";
d.innerHTML=`
<div class="q-text">${i+1}. ${q}</div>
<div class="answers">
<input type="radio" name="q${i}" value="Yes" id="q${i}y"><label class="yes" for="q${i}y">Yes</label>
<input type="radio" name="q${i}" value="No" id="q${i}n"><label class="no" for="q${i}n">No</label>
<input type="radio" name="q${i}" value="N/A" id="q${i}a"><label class="na" for="q${i}a">N/A</label>
</div>
<div class="notes" style="display:none"><textarea placeholder="Notes"></textarea></div>`;
d.addEventListener("change",()=>{
const sel=d.querySelector("input:checked");
const notes=d.querySelector(".notes");
const ta=d.querySelector("textarea");
if(sel && sel.value==="No"){notes.style.display="";ta.classList.toggle("required",!ta.value.trim())}
else{notes.style.display="none";ta.value="";ta.classList.remove("required")}
evaluate();
});
d.querySelector("textarea").addEventListener("input",evaluate);
questionsDiv.appendChild(d);
});
finalNo.checked=true;
}

function state(){
const headerOK=filledBy.value&&jobNumber.value&&room.value;
let anyNo=false,anyUnanswered=false,anyNotes=false;
document.querySelectorAll(".question").forEach(q=>{
const sel=q.querySelector("input:checked");
const ta=q.querySelector("textarea");
if(!sel) anyUnanswered=true;
if(sel&&sel.value==="No"){anyNo=true;if(!ta.value.trim()) anyNotes=true;}
});
return{headerOK,anyNo,anyUnanswered,anyNotes};
}

function evaluate(){
const s=state();
const clean=s.headerOK&&!s.anyNo&&!s.anyUnanswered&&!s.anyNotes;
finalYes.disabled=!clean;
if(!clean){finalYes.checked=false;finalNo.checked=true;}
exportBtn.disabled=!(clean&&finalYes.checked);
dot.classList.toggle("green",clean&&finalYes.checked);
}

finalYes.addEventListener("click",e=>{
if(finalYes.disabled){e.preventDefault();finalNo.checked=true;}
});

document.addEventListener("input",evaluate);
document.addEventListener("change",evaluate);

function saveJSON(){
const s=state();
if(!filledBy.value||!jobNumber.value||!room.value){alert("Fill job details");return;}
if(s.anyNo&&s.anyNotes){alert("Every NO requires notes");return;}
alert("Draft saved (JSON)");
}

function exportPDF(){
if(exportBtn.disabled){alert("Checklist not complete");return;}
alert("PDF exported");
}

function loadJSON(){fileInput.click();}

render();
evaluate();
</script>
</body>
</html>
